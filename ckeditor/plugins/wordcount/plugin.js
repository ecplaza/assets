CKEDITOR.plugins.add("wordcount",{lang:"ar,bg,ca,cs,da,de,el,en,es,eu,fa,fi,fr,he,hr,hu,it,ka,ko,ja,nl,no,pl,pt,pt-br,ru,sk,sv,tr,uk,zh-cn,zh,ro",version:"1.17.10",requires:"htmlwriter,notification,undo",bbcodePluginLoaded:!1,onLoad:function(){CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css")},init:function(n){var a="",t=-1,r=-1,e=-1,o=!1,u=0,i=null,h=function(n,a,t){if(void 0!==document.dispatchEvent){var r;n="ckeditor.wordcount."+n;var e={bubbles:!1,cancelable:!0,detail:{currentLength:a,maxLength:t}};try{r=new CustomEvent(n,e)}catch(a){(r=document.createEvent("CustomEvent")).initCustomEvent(n,e.bubbles,e.cancelable,e.detail)}document.dispatchEvent(r)}},s={showRemaining:!1,showParagraphs:!0,showWordCount:!0,showCharCount:!1,countBytesAsChars:!1,countSpacesAsChars:!1,countHTML:!1,countLineBreaks:!1,hardLimit:!0,warnOnLimitOnly:!1,wordDelims:"",maxWordCount:-1,maxCharCount:-1,maxParagraphs:-1,filter:null,pasteWarningDuration:0,wordCountGreaterThanMaxLengthEvent:function(n,a){h("wordCountGreaterThanMaxLengthEvent",n,a)},charCountGreaterThanMaxLengthEvent:function(n,a){h("charCountGreaterThanMaxLengthEvent",n,a)},wordCountLessThanMaxLengthEvent:function(n,a){h("wordCountLessThanMaxLengthEvent",n,a)},charCountLessThanMaxLengthEvent:function(n,a){h("charCountLessThanMaxLengthEvent",n,a)}},d=CKEDITOR.tools.extend(s,n.config.wordcount||{},!0);d.showParagraphs&&(d.maxParagraphs>-1?d.showRemaining?a+="%paragraphsCount% "+n.lang.wordcount.ParagraphsRemaining:(a+=n.lang.wordcount.Paragraphs+" %paragraphsCount%",a+="/"+d.maxParagraphs):a+=n.lang.wordcount.Paragraphs+" %paragraphsCount%"),d.showParagraphs&&(d.showWordCount||d.showCharCount)&&(a+=", "),d.showWordCount&&(d.maxWordCount>-1?d.showRemaining?a+="%wordCount% "+n.lang.wordcount.WordCountRemaining:(a+=n.lang.wordcount.WordCount+" %wordCount%",a+="/"+d.maxWordCount):a+=n.lang.wordcount.WordCount+" %wordCount%"),d.showCharCount&&d.showWordCount&&(a+=", "),d.showCharCount&&(d.maxCharCount>-1?d.showRemaining?a+="%charCount% "+n.lang.wordcount[d.countHTML?"CharCountWithHTMLRemaining":"CharCountRemaining"]:(a+=n.lang.wordcount[d.countHTML?"CharCountWithHTML":"CharCount"]+" %charCount%",a+="/"+d.maxCharCount):a+=n.lang.wordcount[d.countHTML?"CharCountWithHTML":"CharCount"]+" %charCount%");var c=a;function C(n){return"cke_wordcount_"+n.name}function l(n){return document.getElementById(C(n))}function g(n){if(bbcodePluginLoaded)return n.replace(/\[.*?\]/gi,"");var a=document.createElement("div");return n=m(n),a.innerHTML=n,""==a.textContent&&void 0===a.innerText?"":a.textContent||a.innerText}function m(n){if(d.filter instanceof CKEDITOR.htmlParser.filter){var a=CKEDITOR.htmlParser.fragment.fromHtml(n),t=new CKEDITOR.htmlParser.basicWriter;return d.filter.applyTo(a),a.writeHtml(t),t.getHtml()}return n}function p(a){if(d.countHTML)return d.countBytesAsChars?w(m(a)):m(a).length;var t;if(n.config.fullPage){var r=a.search(new RegExp("<body>","i"));if(-1!=r){var e=a.search(new RegExp("</body>","i"));a=a.substring(r+6,e)}}return t=a,d.countSpacesAsChars||(t=a.replace(/\s/g,"").replace(/&nbsp;/g,"")),t=g(t=d.countLineBreaks?t.replace(/(\r\n|\n|\r)/gm," "):t.replace(/(\r\n|\n|\r)/gm,"").replace(/&nbsp;/gi," ")).replace(/^([\t\r\n]*)$/,""),d.countBytesAsChars?w(t):t.length}function w(n){var a,t=0,r=n.length;for(n=String(n||""),a=0;a<r;a++){var e=encodeURI(n[a]).split("%").length;t+=1==e?1:e-1}return t}function x(n){return n.replace(/&nbsp;/g," ").replace(/(<([^>]+)>)/gi,"").replace(/^\s*$[\n\r]{1,}/gm,"++").split("++").length}function f(n){var a=n.replace(/(<([^>]+)>)/gi," ").replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");a=g(a);var t=d.wordDelims?new RegExp("[\\s"+d.wordDelims+"]+"):/\s+/,r=a.split(t);t=d.wordDelims?new RegExp("^([\\s\\t\\r\\n"+d.wordDelims+"]*)$"):/^([\s\t\r\n]*)$/;for(var e=r.length-1;e>=0;e--)r[e]&&!r[e].match(t)||r.splice(e,1);return r.length}function v(a){if(l(a)){var u,i=0,h=0,s=0;a.fire("beforeGetData",{firedBy:"wordCount.updateCounter"},n),u=a.getData(!0),a.fire("getData",{dataValue:u,firedBy:"wordCount.updateCounter"},n),u&&(d.showCharCount&&(s=p(u)),d.showParagraphs&&(i=x(u)),d.showWordCount&&(h=f(u)));var C=c;if(d.showRemaining?(C=d.maxCharCount>=0?C.replace("%charCount%",d.maxCharCount-s):C.replace("%charCount%",s),C=d.maxWordCount>=0?C.replace("%wordCount%",d.maxWordCount-h):C.replace("%wordCount%",h),C=d.maxParagraphs>=0?C.replace("%paragraphsCount%",d.maxParagraphs-i):C.replace("%paragraphsCount%",i)):C=C.replace("%wordCount%",h).replace("%charCount%",s).replace("%paragraphsCount%",i),(a.config.wordcount||(a.config.wordcount={})).wordCount=h,(a.config.wordcount||(a.config.wordcount={})).charCount=s,CKEDITOR.env.gecko?l(a).innerHTML=C:l(a).innerText=C,s==r&&h==t&&i==e)return(s==d.maxCharCount||h==d.maxWordCount||i>d.maxParagraphs)&&a.fire("saveSnapshot"),!0;var g=h-t,m=s-r,w=i-e;return-1==(t=h)&&(t=h),-1==(r=s)&&(r=s),-1==(e=i)&&(e=i),d.maxWordCount>-1&&h>d.maxWordCount&&g>0||d.maxCharCount>-1&&s>d.maxCharCount&&m>0||d.maxParagraphs>-1&&i>d.maxParagraphs&&w>0?function(a,t){o=!0,!1,d.warnOnLimitOnly||d.hardLimit&&("source"===n.mode&&n.plugins.codemirror?window["codemirror_"+n.id].undo():(a.execCommand("undo"),a.execCommand("undo"))),t||(l(a).className="cke_path_item cke_wordcountLimitReached",a.fire("limitReached",{firedBy:"wordCount.limitReached"},n))}(a,o):(-1==d.maxWordCount||h<=d.maxWordCount)&&(-1==d.maxCharCount||s<=d.maxCharCount)&&(-1==d.maxParagraphs||i<=d.maxParagraphs)?function(n){!0,o=!1,d.warnOnLimitOnly||n.fire("saveSnapshot"),l(n).className="cke_path_item"}(a):a.fire("saveSnapshot"),a.wordCount={paragraphs:i,wordCount:h,charCount:s},d.charCountGreaterThanMaxLengthEvent&&d.charCountLessThanMaxLengthEvent&&(s>d.maxCharCount&&d.maxCharCount>-1?d.charCountGreaterThanMaxLengthEvent(s,d.maxCharCount):d.charCountLessThanMaxLengthEvent(s,d.maxCharCount)),d.wordCountGreaterThanMaxLengthEvent&&d.wordCountLessThanMaxLengthEvent&&(h>d.maxWordCount&&d.maxWordCount>-1?d.wordCountGreaterThanMaxLengthEvent(h,d.maxWordCount):d.wordCountLessThanMaxLengthEvent(h,d.maxWordCount)),!0}}function L(){return d.maxWordCount>-1&&d.maxWordCount-t<5||(d.maxCharCount>-1&&d.maxCharCount-r<20||d.maxParagraphs>-1&&d.maxParagraphs-e<1)}bbcodePluginLoaded=void 0!==n.plugins.bbcode,n.on("key",function(a){var t=L()?5:250;"source"===n.mode&&(clearTimeout(u),u=setTimeout(v.bind(this,a.editor),t)),13==a.data.keyCode&&(clearTimeout(u),u=setTimeout(v.bind(this,a.editor),t))},n),n.on("change",function(n){var a=L()?5:250;clearTimeout(u),u=setTimeout(v.bind(this,n.editor),a)},n),n.on("uiSpace",function(a){var t="cke_wordcount";"rtl"==n.lang.dir&&(t+=" cke_wordcount_rtl"),n.elementMode===CKEDITOR.ELEMENT_MODE_INLINE?"top"==a.data.space&&(a.data.html+='<div class="'+t+'" style="" title="'+n.lang.wordcount.title+'"><span id="'+C(a.editor)+'" class="cke_path_item">&nbsp;</span></div>'):"bottom"==a.data.space&&(a.data.html+='<div class="'+t+'" style="" title="'+n.lang.wordcount.title+'"><span id="'+C(a.editor)+'" class="cke_path_item">&nbsp;</span></div>')},n,null,100),n.on("dataReady",function(n){v(n.editor)},n,null,100),n.on("paste",function(n){if(!d.warnOnLimitOnly&&(d.maxWordCount>0||d.maxCharCount>0||d.maxParagraphs>0)){var a=-1,t=-1,r=-1,e=n.editor.getSelection(),o=e.getNative()?e.getNative().toString().trim():"";n.editor.fire("beforeGetData",{firedBy:"wordCount.onPaste"},n.editor);var u=n.editor.getData(!0);if(n.editor.fire("getData",{dataValue:u,firedBy:"wordCount.onPaste"},n.editor),o.length>0)n.editor.document.getBody().getText().length===o.length&&(u="");u+=n.data.dataValue,d.showCharCount&&(t=p(u)),d.showWordCount&&(a=f(u)),d.showParagraphs&&(r=x(u)),null===i&&(i=new CKEDITOR.plugins.notification(n.editor,{message:n.editor.lang.wordcount.pasteWarning,type:"warning",duration:d.pasteWarningDuration})),d.maxCharCount>0&&t>d.maxCharCount&&d.hardLimit&&(i.isVisible()||i.show(),n.cancel()),d.maxWordCount>0&&a>d.maxWordCount&&d.hardLimit&&(i.isVisible()||i.show(),n.cancel()),d.maxParagraphs>0&&r>d.maxParagraphs&&d.hardLimit&&(i.isVisible()||i.show(),n.cancel())}},n,null,100),n.on("afterPaste",function(n){v(n.editor)},n,null,100),n.on("afterPasteFromWord",function(n){v(n.editor)},n,null,100)}});