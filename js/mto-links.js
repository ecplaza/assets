webpackJsonp([26],{346:function(t,e,n){t.exports=n(347)},347:function(t,e,n){"use strict";(function(t){var e=n(0);n(19);var a=n(348);t.initForm=function(){if(ECP.Context.form){var t=ECP.module.formValidator.init(ECP.Context.form);t.data("bootstrapValidator").options.misc.onSuccess=function(t){var n=e("#connect_type_id").val();e("input[name=account]",t).val(e("input[name=account"+n+"]",t).val()),e("input[name=connect_name]",t).val(e("input[name=connect_name"+n+"]",t).val()),ECP.module.Ladda.create(t.find(".ladda-button")[0]).start()};var n=new a({input:"#js-hidden-wechat-url",formValidator:t.data("bootstrapValidator"),callback:function(t){var a=t.data;e(".js-qr-valid-icon").addClass("hidden"),t.error?alert("We can't process your image. Please use other image."):a&&(n.stopScanner(),a.indexOf("wechat.com")>0?(n.setQrInputValue(a),e(".js-qr-valid-icon").removeClass("hidden"),e("#js-video-icon").addClass("hidden")):(ECP.Logger.error("qrcode error. url:"+a),alert("Not a WeChat QR code.")))},cameraInitialized:function(){var t=e("#connect_type_id")[0].selectize;t.getValue()&&t.trigger("change",t.getValue())}});e("#connect_type_id").selectize({render:{item:function(t,e){return'<div><img src="'+ECP.Context.getData("site.assets","www.ecplaza.net")+"/images/social/"+t.text.toLowerCase()+'.png" alt="'+e(t.text)+'">&nbsp;'+e(t.text)+"</div>"},option:function(t,e){return'<div><img src="'+ECP.Context.getData("site.assets","www.ecplaza.net")+"/images/social/"+t.text.toLowerCase()+'.png" class="m-2" width="20" height="20" alt="'+e(t.text)+'">&nbsp;'+e(t.text)+"</div>"}},onChange:function(a){t.find("input[type=text],input[type=url],input[type=file]").prop("disabled",!0).closest(".input-group-wrap").closest(".form-group").addClass("hidden"),e("#js-hidden-wechat-url").prop("disabled",!0),t.find("input[name=account"+a+"]").prop("disabled",!1).closest(".form-group").removeClass("hidden").find("input[name=qr-input]").prop("disabled",!1);var i=e("#connect_type_id").data("old-value");i&&i!==a&&t.data("bootstrapValidator").resetField("account"+i),"WeChat"===t.find("input[name=connect_name"+a+"]").val()?n.startScanner():n.stopScanner()},onFocus:function(t){var t=this.getValue();e("#connect_type_id").data("old-value",t)}}),t.find(".btn-cancel").click(function(){document.location.href="/mto/links"}),t.find(".js-btn-upload").click(function(t){t.preventDefault(),e("#js-qr-file").trigger("click")})}}}).call(e,n(1))},348:function(t,e,n){"use strict";(function(e){function a(t){"stop"===t?i("#js-toggle-play-btn").html('<i class="fa fa-play-circle"></i> Start Scanning'):i("#js-toggle-play-btn").html('<i class="fa fa-stop"></i> Stop Scanning')}var i=n(0),s=e.QrScanner,c=e.ECP,o={input:"qrcode",formValidator:null,callback:function(t){},tabSwitched:null,cameraInitialized:null},r=function(t){this.settings=i.extend({},o,t),this.video=document.getElementById("js-qr-video"),this.videoIcon=document.getElementById("js-video-icon"),this.$validIcon=i(".js-qr-valid-icon"),this.fileInput=document.getElementById("js-qr-file"),this.isScanning=!1,this.activeTab="image",this.hasCamera=!1;var e=this;s.hasCamera().then(function(){e.hasCamera=!0,e.switchTab("camera"),e.video.classList.remove("hidden"),e.qrScanner=new s(e.video,e.settings.callback,{highlightScanRegion:!0,highlightCodeOutline:!0,returnDetailedScanResult:!0}),i("#js-toggle-play-btn").removeClass("wt-is-disabled").click(function(){e.isScanning?e.stopScanner():e.startScanner()}),a("start"),e.settings.cameraInitialized&&e.settings.cameraInitialized()}),i("#js-switch-image-btn").click(function(){e.stopScanner(),e.switchTab("image")}),i("#js-switch-camera-btn").click(function(){e.switchTab("camera"),e.startScanner()}),this.fileInput.addEventListener("change",function(t){var n=e.fileInput.files[0];i(e.fileInput).prop("value",""),n&&(e.resetQrInput(),s.scanImage(n,{returnDetailedScanResult:!0}).then(e.settings.callback).catch(function(t){e.settings.callback({error:t||"No QR code found."})}))})};r.prototype.startScanner=function(){this.hasCamera&&(this.video.classList.remove("hidden"),this.videoIcon.classList.add("hidden"),this.resetQrInput(),this.qrScanner.start(),this.isScanning=!0,a("start"))},r.prototype.stopScanner=function(){this.hasCamera&&(this.qrScanner.stop(),this.isScanning=!1,a("stop"),this.video.classList.add("hidden"),this.videoIcon.classList.remove("hidden"))},r.prototype.switchTab=function(t){"camera"===t?(i("#tab-camera").removeClass("hidden"),i("#tab-image").addClass("hidden"),this.video.classList.add("hidden"),this.videoIcon.classList.remove("hidden")):(i("#tab-camera").addClass("hidden"),i("#tab-image").removeClass("hidden")),this.activeTab=t,this.resetQrInput(),this.settings.tabSwitched&&this.settings.tabSwitched()},r.prototype.resetQrInput=function(){this.setQrInputValue("")},r.prototype.setQrInputValue=function(t){var e=i(this.settings.input);e.val(t),this.settings.formValidator.resetField(e),this.$validIcon.addClass("hidden")},c&&c.module&&(c.module.QRScan=r),t.exports=r}).call(e,n(1))}},[346]);